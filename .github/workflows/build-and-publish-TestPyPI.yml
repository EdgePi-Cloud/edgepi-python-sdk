# This workflow will build and publish the package to TestPyPI upon push or merge to dev branch

name: Build and Publish to TestPyPI

on:
  push:
    branches:
      - 'fix-staging-publish'

jobs:
  build-and-publish:
    name: Build and publish Package to TestPyPI
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
          persist-credentials: false
    # - name: Set up Python
    #   uses: actions/setup-python@v3
      # with:
      #   python-version: '3.10'
    # - name: Install Dependencies
    #   run: |
    #     python -m pip install --upgrade pip
    #     if [ -f requirements_build.txt ]; then python -m pip install -r requirements_build.txt; fi
    - name: current_version
      run: echo "current_version=$(grep '# version' setup.py | cut -d ' ' -f3)" >> $GITHUB_ENV
    - name: FragileTech/bump-version
      uses: FragileTech/bump-version@main
      with:
        files: setup.py
        commit_name: EdgePi-Cloud
        commit_email: edgepi@edgepi.com
        login: EdgePi-Cloud
        token: "${{ secrets.TEMP_BOT_TOKEN }}"
    # - name: Build Package
    #   run: |
    #     python -m build
    # - name: Publish Distribution to TestPyPI
    #   uses: pypa/gh-action-pypi-publish@master
    #   with:
    #     password: ${{ secrets.TEST_PYPI_API_TOKEN }}
    #     repository_url: https://test.pypi.org/legacy/
